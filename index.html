<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Placar de V√¥lei com Configura√ß√£o Inicial</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .hidden {
      display: none;
    }
    .btn {
      margin: 5px 0;
      padding: 8px 12px;
      cursor: pointer;
    }
    input[type="text"], select {
      padding: 6px;
      width: 200px;
      margin-bottom: 10px;
    }
    .players-container {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }
    .team {
      flex: 1;
      margin-right: 10px;
    }
    .team:last-child {
      margin-right: 0;
    }
    #finishedGamesSetupList div,
    #finishedGamesList div {
      margin-bottom: 4px;
    }
    /* Estilo do placar */
    #scoreboard {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 15px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    #scoreboard .names {
      display: flex;
      justify-content: space-between;
      width: 260px;
      font-weight: bold;
      margin-bottom: 5px;
    }
    #scoreboard .scores {
      display: flex;
      justify-content: space-between;
      align-items: center;
      width: 260px;
    }
    #teamA-score, #teamB-score {
      font-size: 2.5rem;
      min-width: 80px;
      text-align: center;
      user-select: none;
    }
    #teamA-score { color: #0057e7; }
    #teamB-score { color: #d62d20; }
    #scoreboard .vs { font-size: 1.8rem; }
  </style>
</head>
<body>
  <h1>Configura√ß√£o do Jogo de V√¥lei</h1>

  <div id="setupContainer">
    <div>
      <label for="teamAName">Nome da Dupla 1:</label><br />
      <input type="text" id="teamAName" placeholder="Ex: Ana&Bia" autocomplete="off"/>
    </div>
    <div>
      <label for="teamAPlayers">Jogadores da Dupla 1 (separe por v√≠rgula):</label><br />
      <input type="text" id="teamAPlayers" placeholder="Ex: Ana,Bia" autocomplete="off"/>
    </div>
    <div>
      <label for="teamBName">Nome da Dupla 2:</label><br />
      <input type="text" id="teamBName" placeholder="Ex: Clara&Duda" autocomplete="off"/>
    </div>
    <div>
      <label for="teamBPlayers">Jogadores da Dupla 2 (separe por v√≠rgula):</label><br />
      <input type="text" id="teamBPlayers" placeholder="Ex: Clara,Duda" autocomplete="off"/>
    </div>
    <div>
      <label for="tournamentPhaseSelect">Fase do Torneio:</label><br />
      <select id="tournamentPhaseSelect">
        <option value="" disabled selected>Selecione a fase</option>
        <option value="Fase de Grupos">Fase de Grupos</option>
        <option value="Quartas de Final">Quartas de Final</option>
        <option value="Semifinal">Semifinal</option>
        <option value="Final">Final</option>
      </select>
    </div>
    <div>
      <label for="initialServerTeam">Sacador inicial (dupla):</label><br />
      <select id="initialServerTeam">
        <option value="" disabled selected>Escolha a dupla</option>
        <option value="A">Dupla 1</option>
        <option value="B">Dupla 2</option>
      </select>
    </div>
    <div>
      <label for="initialServerIndex">√çndice do sacador (0 ou 1):</label><br />
      <select id="initialServerIndex">
        <option value="" disabled selected>√çndice</option>
        <option value="0">0</option>
        <option value="1">1</option>
      </select>
    </div>
    <button id="startGameBtn" class="btn">Iniciar Jogo</button>

    <hr />
    <h3>Jogos Finalizados</h3>
    <div id="finishedGamesSetupList"><i>Nenhum jogo finalizado salvo.</i></div>
  </div>

  <div id="gameContainer" class="hidden">
    <h2>Jogo: <span id="displayTeams"></span></h2>
    <div>
      <label for="tournamentPhase">Fase do Torneio:</label>
      <select id="tournamentPhase" onchange="changePhase()">
        <option value="Fase de Grupos">Fase de Grupos</option>
        <option value="Quartas de Final">Quartas de Final</option>
        <option value="Semifinal">Semifinal</option>
        <option value="Final">Final</option>
      </select>
    </div>

    <div id="teamsDisplay" style="font-weight:bold; font-size:1.1em; text-align:center; margin:10px 0;"></div>
    
    <div id="scoreboard">
      <div class="names">
        <div id="teamA-name">Dupla 1</div>
        <div id="teamB-name" style="text-align:right;">Dupla 2</div>
      </div>
      <div class="scores">
        <div id="teamA-score">0</div>
        <div class="vs">x</div>
        <div id="teamB-score">0</div>
      </div>
    </div>

    <div id="playersContainer" class="players-container"></div>

    <div>
      <h3>Set <span id="set-info">1</span></h3>
      <div>
        <button class="btn" onclick="addPoint('A')">Ponto para <span id="btnTeamAName"></span></button>
        <button class="btn" onclick="addPoint('B')">Ponto para <span id="btnTeamBName"></span></button>
      </div>
      <div>
        <button class="btn" onclick="undo()">Desfazer √öltima</button>
        <button class="btn" onclick="finishSet()">Finalizar Set</button>
        <button class="btn" onclick="finishGame()">Finalizar Jogo</button>
      </div>
    </div>

    <pre id="summary"></pre>

    <hr />
    <h3>Jogos Finalizados</h3>
    <div id="finishedGamesList"><i>Nenhum jogo finalizado salvo.</i></div>
  </div>

<script>
  let teamAName = "", teamBName = "";
  let teamA = [], teamB = [];
  let scoreA = 0, scoreB = 0;
  let currentSet = 1, sets = [];
  let server = null;
  let lastServerIndexA = 0, lastServerIndexB = 0;
  let historyStack = [], finishedGames = [];
  let tournamentPhase = "";

  function validateSetup(aName, aArr, bName, bArr, phase, servTeam, servIdx) {
    if (!aName || !bName) { alert("Informe o nome das duplas."); return false; }
    if (aArr.length !== 2 || bArr.length !== 2) {
      alert("Duas duplas de 2 jogadores cada."); return false;
    }
    if (!phase) { alert("Selecione a fase."); return false; }
    if (!(servTeam === "A" || servTeam === "B")) { alert("Escolha a dupla sacadora."); return false; }
    if (!(servIdx === 0 || servIdx === 1)) { alert("√çndice do sacador deve ser 0 ou 1."); return false; }
    return true;
  }

  document.getElementById("startGameBtn").addEventListener("click", () => {
    const aName = document.getElementById("teamAName").value.trim();
    const aArr = document.getElementById("teamAPlayers").value.trim().split(",").map(s=>s.trim()).filter(s=>s);
    const bName = document.getElementById("teamBName").value.trim();
    const bArr = document.getElementById("teamBPlayers").value.trim().split(",").map(s=>s.trim()).filter(s=>s);
    const phase = document.getElementById("tournamentPhaseSelect").value;
    const servTeam = document.getElementById("initialServerTeam").value;
    const servIdx = parseInt(document.getElementById("initialServerIndex").value,10);

    if (!validateSetup(aName, aArr, bName, bArr, phase, servTeam, servIdx)) return;

    teamAName = aName; teamBName = bName;
    teamA = aArr; teamB = bArr;
    tournamentPhase = phase;
    server = {team:servTeam, index:servIdx};
    lastServerIndexA = (servTeam==="A"?servIdx:0);
    lastServerIndexB = (servTeam==="B"?servIdx:0);
    scoreA = 0; scoreB = 0;
    currentSet = 1; sets = []; historyStack = [];

    document.getElementById("setupContainer").classList.add("hidden");
    document.getElementById("gameContainer").classList.remove("hidden");
    document.getElementById("tournamentPhase").value = tournamentPhase;
    document.getElementById("set-info").textContent = currentSet;
    document.getElementById("btnTeamAName").textContent = teamAName;
    document.getElementById("btnTeamBName").textContent = teamBName;
    document.getElementById("displayTeams").textContent = `${teamAName} vs ${teamBName}`;
    document.getElementById("teamsDisplay").textContent = `${teamA.join(" / ")} vs ${teamB.join(" / ")}`;

    document.getElementById("teamA-name").textContent = teamAName;
    document.getElementById("teamB-name").textContent = teamBName;

    renderPlayers();
    renderSummary();
    updateFinishedGamesList();
  });

  function renderPlayers() {
    const c = document.getElementById("playersContainer");
    c.innerHTML = "";
    [[teamAName,teamA,"A"], [teamBName,teamB,"B"]].forEach(([nm, pl, lbl])=>{
      const div = document.createElement("div"); div.className="team";
      const h = document.createElement("h4"); h.textContent = nm;
      div.appendChild(h);
      pl.forEach((p,i)=>{
        const pEl = document.createElement("p");
        pEl.textContent = `${p} (P${i})${server && server.team===lbl && server.index===i ? " üéæ":""}`;
        if (server && server.team===lbl && server.index===i) pEl.style.fontWeight = "bold";
        div.appendChild(pEl);
      });
      c.appendChild(div);
    });
  }

  function addPoint(team) {
    if (!(team==="A"||team==="B")) return;
    historyStack.push({scoreA,scoreB,server:{...server},currentSet,lastServerIndexA,lastServerIndexB});
    if (team==="A") { scoreA++; lastServerIndexA=server.index; }
    else { scoreB++; lastServerIndexB=server.index; }
    if (server.team!==team) {
      server.team=team;
      if (team==="A") server.index = lastServerIndexA===0?1:0;
      else server.index = lastServerIndexB===0?1:0;
      lastServerIndexA = server.team==="A"?server.index:lastServerIndexA;
      lastServerIndexB = server.team==="B"?server.index:lastServerIndexB;
    }
    renderPlayers(); renderSummary();
  }

  function undo() {
    if (!historyStack.length) return alert("Nada para desfazer.");
    const s = historyStack.pop();
    scoreA=s.scoreA; scoreB=s.scoreB;
    server=s.server; currentSet=s.currentSet;
    lastServerIndexA=s.lastServerIndexA; lastServerIndexB=s.lastServerIndexB;
    document.getElementById("set-info").textContent = currentSet;
    renderPlayers(); renderSummary();
  }

  function finishSet() {
    if (scoreA===0 && scoreB===0) return alert("O set n√£o pode terminar 0 x 0.");
    sets.push({set:currentSet,scoreA,scoreB});
    currentSet++; scoreA=0; scoreB=0; historyStack=[];
    document.getElementById("set-info").textContent = currentSet;
    renderSummary(); updateScores();
  }

  function finishGame() {
    if (!sets.length) return alert("Finalize um set antes do jogo.");
    const winner = sets.filter(s=>s.scoreA>s.scoreB).length > sets.filter(s=>s.scoreB>s.scoreA).length ?
                   teamAName : teamBName;
    finishedGames.push({teamAName,teamBName,sets:sets.slice(),winner,phase:tournamentPhase});
    updateFinishedGamesList();
    document.getElementById("setupContainer").classList.remove("hidden");
    document.getElementById("gameContainer").classList.add("hidden");
  }

  function renderSummary() {
    updateScores();
    let txt = `Fase: ${tournamentPhase}\nSets: ${sets.length}\n`;
    sets.forEach(s=>txt+=`Set ${s.set}: ${teamAName} ${s.scoreA} x ${s.scoreB} ${teamBName}\n`);
    txt+=`\nAtual: ${teamAName} ${scoreA} x ${scoreB} ${teamBName}\n`;
    const sac = server ? (server.team==="A"?teamA[server.index]:teamB[server.index]) : "N/D";
    txt += `Sacador: ${sac}`;
    document.getElementById("summary").textContent = txt;
  }

  function updateScores() {
    document.getElementById("teamA-score").textContent = scoreA;
    document.getElementById("teamB-score").textContent = scoreB;
  }

  function changePhase() {
    tournamentPhase = document.getElementById("tournamentPhase").value;
    renderSummary();
  }

  function updateFinishedGamesList() {
    const c1 = document.getElementById("finishedGamesList");
    const c2 = document.getElementById("finishedGamesSetupList");
    [c1,c2].forEach(c=>{
      if (!finishedGames.length) c.innerHTML = "<i>Nenhum jogo finalizado salvo.</i>";
      else {
        c.innerHTML = "";
        finishedGames.forEach((g,i)=>{
          const d = document.createElement("div");
          d.textContent = `${i+1}. ${g.teamAName} vs ${g.teamBName} - V: ${g.winner}`;
          c.appendChild(d);
        });
      }
    });
  }

  // inicia com tela de setup e lista vazia
  document.getElementById("gameContainer").classList.add("hidden");
  updateFinishedGamesList();

</script>
</body>
</html>
